<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.44" />
    <meta name="description" content="">


    <link rel="shortcut icon" href="/Docs/images/favicon.png" type="image/x-icon" />
<link rel="icon" href="/Docs/images/favicon.png" type="image/x-icon" />
    <title>Rapiro Robot :: Horned Sungem Documentation</title>
    
    
    <link href="/Docs/css/nucleus.css?1531997864" rel="stylesheet">
    <link href="/Docs/css/font-awesome.min.css?1531997864" rel="stylesheet">
    <link href="/Docs/css/hybrid.css?1531997864" rel="stylesheet">
    <link href="/Docs/css/featherlight.min.css?1531997864" rel="stylesheet">
    <link href="/Docs/css/perfect-scrollbar.min.css?1531997864" rel="stylesheet">
    <link href="/Docs/css/auto-complete.css?1531997864" rel="stylesheet">
    <link href="/Docs/css/theme.css?1531997864" rel="stylesheet">
    <link href="/Docs/css/hugo-theme.css?1531997864" rel="stylesheet">
    
      <link href="/Docs/css/theme-mine.css?1531997864" rel="stylesheet">
    

    <script src="/Docs/js/jquery-2.x.min.js?1531997864"></script>
    
    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{ 
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/Docs/workflow/diy/rapiro/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <div>
	<a href="/Docs/" ><img align="left" src="/Docs/logo.png"></a>
</div>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fa fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Search...">
    <span data-search-clear=""><i class="fa fa-close"></i></span>
</div>

<script type="text/javascript" src="/Docs/js/lunr.min.js?1531997864"></script>
<script type="text/javascript" src="/Docs/js/auto-complete.js?1531997864"></script>
<script type="text/javascript">
    
        var baseurl = "\/Docs";
    
</script>
<script type="text/javascript" src="/Docs/js/search.js?1531997864"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/Docs/installation/" title="Installation Guide" class="dd-item 
        
        
        
        ">
      <a href="/Docs/installation/">
          Installation Guide
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/Docs/quickstart/" title="Quick Start" class="dd-item 
        
        
        
        ">
      <a href="/Docs/quickstart/">
          Quick Start
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/Docs/model/" title="Model List" class="dd-item 
        
        
        
        ">
      <a href="/Docs/model/">
          Model List
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/Docs/workflow/" title="Examples and Tutorials" class="dd-item 
        parent
        
        
        ">
      <a href="/Docs/workflow/">
          Examples and Tutorials
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/Docs/workflow/python/" title="Python" class="dd-item 
        
        
        
        ">
      <a href="/Docs/workflow/python/">
          Python
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/Docs/workflow/python/detector/" title="Face detector" class="dd-item ">
        <a href="/Docs/workflow/python/detector/">
        Face detector
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/Docs/workflow/python/detector_object/" title="Object Detector" class="dd-item ">
        <a href="/Docs/workflow/python/detector_object/">
        Object Detector
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/Docs/workflow/python/recorder/" title="Scene Recorder" class="dd-item ">
        <a href="/Docs/workflow/python/recorder/">
        Scene Recorder
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/Docs/workflow/python/image_recognition/" title="Image Recogniser (Low-level API Tutorial)" class="dd-item ">
        <a href="/Docs/workflow/python/image_recognition/">
        Image Recogniser (Low-level API Tutorial)
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/Docs/workflow/python/face_recognition/" title="Face recorder (Working with two HS devices)" class="dd-item ">
        <a href="/Docs/workflow/python/face_recognition/">
        Face recorder (Working with two HS devices)
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/Docs/workflow/python/ocr/" title="" class="dd-item ">
        <a href="/Docs/workflow/python/ocr/">
        
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/Docs/workflow/android/" title="Android" class="dd-item 
        
        
        
        ">
      <a href="/Docs/workflow/android/">
          Android
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/Docs/workflow/android/android_hello2018/" title="Hello 2018" class="dd-item ">
        <a href="/Docs/workflow/android/android_hello2018/">
        Hello 2018
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/Docs/workflow/android/android_face_detector/" title="Face Detector" class="dd-item ">
        <a href="/Docs/workflow/android/android_face_detector/">
        Face Detector
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/Docs/workflow/android/android_object_detector/" title="Object Detector" class="dd-item ">
        <a href="/Docs/workflow/android/android_object_detector/">
        Object Detector
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/Docs/workflow/android/android_sketchguess/" title="SketchGuess" class="dd-item ">
        <a href="/Docs/workflow/android/android_sketchguess/">
        SketchGuess
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/Docs/workflow/ros/" title="ROS" class="dd-item 
        
        
        
        ">
      <a href="/Docs/workflow/ros/">
          ROS
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/Docs/workflow/ros/quickstart/" title="ROS Tutorial(Chinese)" class="dd-item ">
        <a href="/Docs/workflow/ros/quickstart/">
        ROS Tutorial(Chinese)
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/Docs/workflow/diy/" title="DIY" class="dd-item 
        parent
        
        
        ">
      <a href="/Docs/workflow/diy/">
          DIY
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/Docs/workflow/diy/rapiro/" title="Rapiro Robot" class="dd-item active">
        <a href="/Docs/workflow/diy/rapiro/">
        Rapiro Robot
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/Docs/workflow/diy/smartlamp/" title="Smart Lamp" class="dd-item ">
        <a href="/Docs/workflow/diy/smartlamp/">
        Smart Lamp
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/Docs/workflow/diy/sitting_pose/" title="Sitting posture alarm" class="dd-item ">
        <a href="/Docs/workflow/diy/sitting_pose/">
        Sitting posture alarm
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/Docs/workflow/diy/raspi_car/" title="Raspberry Pi Toy Car" class="dd-item ">
        <a href="/Docs/workflow/diy/raspi_car/">
        Raspberry Pi Toy Car
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/Docs/api/" title="HS-API" class="dd-item 
        
        
        
        ">
      <a href="/Docs/api/">
          HS-API
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/Docs/api/lowlevel/" title="Low Level API" class="dd-item ">
        <a href="/Docs/api/lowlevel/">
        Low Level API
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/Docs/api/highlevel/" title="High-level API" class="dd-item ">
        <a href="/Docs/api/highlevel/">
        High-level API
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/Docs/api/android/" title="Android API" class="dd-item ">
        <a href="/Docs/api/android/">
        Android API
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/Docs/contact/" title="Contact us" class="dd-item 
        
        
        
        ">
      <a href="/Docs/contact/">
          Contact us
          
      </a>
      
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fa fa-fw fa-language"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="/Docs/workflow/diy/rapiro/" selected>English</option>
                    
                  
              
                  
              
          
              
              
                  
              
                  
                    
                    
                      <option id="cn" value="/Docs/cn/workflow/diy/rapiro/">Chinese</option>
                    
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
       
      
      
      </ul>
    </section>
    
    <section id="footer">
      <a class="github-button" href="https://github.com/HornedSungem/SungemSDK" data-icon="octicon-cloud-download" aria-label="Download Horned Sungem SDK on GitHub">Github Link</a>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fa fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
                  
                  <span class="links">
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='/Docs/'>Horned Sungem Documentation</a> > <a href='/Docs/workflow/'>Examples and Tutorials</a> > <a href='/Docs/workflow/diy/'>DIY</a> > Rapiro Robot
          
         
          
         
          
         
          
           
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#workflow">Workflow</a></li>
<li><a href="#implementation">Implementation</a></li>
<li><a href="#outcome">Outcome</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            

        
        <div id="body-inner">
          
            <h1>Rapiro Robot</h1>
          

        




<p>This chapter introduced how to build a robot that controlled by HS face detector.</p>

<blockquote>
<p>Hardware requirement:</p>

<ul>
<li>Horned Sungem Device</li>
<li>Raspberry Pi 3b</li>
<li>Rapiro Robot</li>
<li>12V to 5V DC-DC module (Optional)</li>
<li>Cooling fan (Optional)</li>
</ul>
</blockquote>

<h2 id="workflow">Workflow</h2>

<p><img src="/Docs/media/15263802958185/2-1.jpg" alt="2-1" /></p>

<p>The built-in model Mobilenet-SSD face detector is used in this DIY demo. The logic is illustrated as below:</p>

<p><img src="/Docs/media/15263802958185/2-2.jpg" alt="2-2" /></p>

<h2 id="implementation">Implementation</h2>

<p>Firstly assemble and power the Rapiro robot, then use robot to supply the power to a Raspeberry Pi. The signal is sent through USB port.</p>

<p>Please note that due to the low stability of Raspberry Pi USB power transfer, it might be sometimes insufficient to power the HS device. However, it&rsquo;s possible to use an extra cable to power the HS.</p>

<p>To make to robot looks good, we put all things into his head:</p>

<p><img src="/Docs/media/15263802958185/3-1.jpg" alt="3-1" /></p>

<p>The controlling code for rapiro robot:</p>

<pre><code class="language-python">class RapiroProcessor(Thread):

    class Flags:
        face = None
        face_frame_cnt = 0
        head_angle = 90
        arm_raised = False
        light_on = False
        light_need_change = False

    def __init__(self, connection):
        Thread.__init__(self)
        self.daemon = True
        self.rapiro = Rapiro(connection)
        self.flags = RapiroProcessor.Flags()

    def reset(self):
        self.rapiro.execute(GO_TO_INITIAL_POSITION)
        time.sleep(3)

    def run(self):
        self.reset()
        try:
            while True:
                time.sleep(0.1)
                has_face = self.flags.face is not None
                frame_cnt = self.flags.face_frame_cnt
                comm = &quot;&quot;
                if has_face:  # Head pose
                    x1 = self.flags.face[2]
                    x2 = self.flags.face[4]
                    x_mid = (x1 + x2) / 2
                    if x_mid &gt; 0.6 or x_mid / 2 &lt; 0.4:
                        angle = self.flags.head_angle - int((x_mid - 0.5) / 0.1)
                    else:
                        angle = self.flags.head_angle
                    angle = 180 if angle &gt; 180 else angle
                    angle = 0 if angle &lt; 0 else angle
                    self.flags.head_angle = angle
                    eye = (246, 124, 1)
                    frame_cnt += 1
                else:
                    eye = (2, 220, 255)
                    frame_cnt -= 1

                self.flags.light_need_change = (not has_face if self.flags.light_on else has_face)
                self.flags.light_on = has_face

                if frame_cnt &gt; 5:  # Raise hand
                    self.flags.face_frame_cnt = 5
                    if not self.flags.arm_raised:
                        comm += r_shoulder_yz(90, 1)
                        self.flags.arm_raised = True
                elif frame_cnt &lt; -5:  # Put hand down
                    self.flags.face_frame_cnt = -5
                    if self.flags.arm_raised:
                        comm += r_shoulder_yz(0, 1)
                        self.flags.arm_raised = False
                else:
                    self.flags.face_frame_cnt = frame_cnt

                if self.flags.light_need_change:  # Change eyes colour
                    comm += eye_color(eye[0], eye[1], eye[2], 1)
                comm += head_yaw(self.flags.head_angle, 1)

                self.rapiro.execute(comm)
        finally:
            self.reset()
</code></pre>

<p>the python code for HS:</p>

<pre><code class="language-python">#!/usr/bin/env python3
# coding=utf-8

from SungemSDK.api import hsapi as hs
import rapiro
import video


def process(ret):
    img = ret[0]
    face = []
    img_w = img.shape[1]
    img_h = img.shape[0]
    for box in ret[1]:
        if (box[4] - box[2] &gt; img_w * 0.8) \
                and (box[5] - box[3] &gt; img_h * 0.8):
            continue
        box[2] /= img_w
        box[4] /= img_w
        box[3] /= img_h
        box[5] /= img_h
        face.append(box)
    return face


if __name__ == '__main__':
    t_rapiro = rapiro.RapiroProcessor(&quot;/dev/ttyUSB0&quot;)  # 控制线程
    t_video = video.VideoProcessor((&quot;192.168.50.202&quot;, 10600))  # 视频线程

    try:
        net = hs.HS('FaceDetector', zoom=True, verbose=0, threshSSD=0.55,
                    graphFolder=&quot;../../SungemSDK/examples/graphs/&quot;)
        t_rapiro.start()
        t_video.start()
        while True:
            result = net.run()
            image = net.plotSSD(result)

            faces = process(result)
            t_rapiro.flags.face = faces[0] if len(faces) &gt; 0 else None

            if t_video.has_client():
                t_video.input_queue.put(image)
    finally:
        t_rapiro.reset()
</code></pre>

<h2 id="outcome">Outcome</h2>

<p>When face is detected, the robot will turn his head to the face, raises right hand and his eyes will turn yellow. If no face detected, he will return to the default status.</p>

<p><img src="/Docs/media/15263802958185/4-1.gif" alt="4-1" />
<img src="/Docs/media/15263802958185/4-2.gif" alt="4-2" /></p>


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
        
        


        
            <a class="nav nav-prev" href="/Docs/workflow/diy/" title="DIY"> <i class="fa fa-chevron-left"></i></a>
        
        
            <a class="nav nav-next" href="/Docs/workflow/diy/smartlamp/" title="Smart Lamp" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
        
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/Docs/js/clipboard.min.js?1531997864"></script>
    <script src="/Docs/js/perfect-scrollbar.min.js?1531997864"></script>
    <script src="/Docs/js/perfect-scrollbar.jquery.min.js?1531997864"></script>
    <script src="/Docs/js/jquery.sticky.js?1531997864"></script>
    <script src="/Docs/js/featherlight.min.js?1531997864"></script>
    <script src="/Docs/js/html5shiv-printshiv.min.js?1531997864"></script>
    <script src="/Docs/js/highlight.pack.js?1531997864"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/Docs/js/modernizr.custom.71422.js?1531997864"></script>
    <script src="/Docs/js/learn.js?1531997864"></script>
    <script src="/Docs/js/hugo-learn.js?1531997864"></script>

    <link href="/Docs/mermaid/mermaid.css?1531997864" type="text/css" rel="stylesheet" />
    <script src="/Docs/mermaid/mermaid.js?1531997864"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

